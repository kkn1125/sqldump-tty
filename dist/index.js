(()=>{"use strict";var e={789:function(e,t,a){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.OUTPUT_DIR=t.DB_PW=t.DB_USER=t.DB_HOST=void 0;const s=o(a(818)),n=o(a(928));s.default.config({path:n.default.join(n.default.resolve(),".env")}),t.DB_HOST=process.env.DB_HOST,t.DB_USER=process.env.DB_USER,t.DB_PW=process.env.DB_PW,t.OUTPUT_DIR=process.env.OUTPUT_DIR||"./"},156:function(e,t,a){var o=this&&this.__createBinding||(Object.create?function(e,t,a,o){void 0===o&&(o=a);var s=Object.getOwnPropertyDescriptor(t,a);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,o,s)}:function(e,t,a,o){void 0===o&&(o=a),e[o]=t[a]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&o(t,e,a);return s(t,e),t},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const c=a(733),i=a(317),l=r(a(293)),u=r(a(608)),m=n(a(896)),f=r(a(498)),d=r(a(928)),w=a(789);let _="",p="",h="";async function b(e){const[t]=await e.query("select schema_name from information_schema.`schemata` where schema_name != 'mysql' and schema_name != 'test' and schema_name != 'information_schema'"),a=t.map((({schema_name:e})=>e)),o=await(0,c.select)({message:"백업할 스키마를 선택하세요.",choices:[...a,new c.Separator,"설치 폴더 열기","설치 폴더 선택 열기","종료"],loop:!1});switch(console.log(`✅ Selcted: ${o}`),!0){case a.includes(o):break;case"설치 폴더 열기"===o:return await new Promise((e=>{(0,i.spawn)("cmd",["/C","start",w.OUTPUT_DIR]).on("close",(()=>{e(!0)}))})),void b(e);case"설치 폴더 선택 열기"===o:return await y(),void b(e);case"종료"===o:process.exit(0)}switch(_=d.default.join(w.OUTPUT_DIR,"output",o),await new Promise((e=>{(0,i.spawn)("mkdir",["-p",_]).on("close",(()=>{e(!0)}))})),await(0,c.select)({message:"메뉴를 선택하세요.",choices:["전체 테이블 xlsx,csv,sql로 내보내기","선택 테이블 xlsx,csv,sql로 내보내기",new c.Separator,"다른 스키마 선택","종료"]})){case"전체 테이블 xlsx,csv,sql로 내보내기":await v(e,o),console.log("✨ 저장되었습니다."),await O(o),b(e);break;case"선택 테이블 xlsx,csv,sql로 내보내기":await async function(e,t){try{const[a]=await e.query("SELECT table_name FROM information_schema.`tables` WHERE table_schema = ?",[t]),o=a.map((({table_name:e})=>e)),s=await(0,c.checkbox)({message:"내보낼 테이블을 선택하세요.",choices:[...o]});if(console.log("selectedTables",s),s.includes("모든 테이블 선택"))return void await v(e,t);if(s.includes("취소"))return void console.log("❌ 작업이 취소되었습니다.");await x(t);const n=new u.default.Workbook;n.creator="kkn1125",n.created=new Date,n.modified=new Date,n.lastPrinted=new Date;for(const a of s)try{console.log(`Exporting table: ${a}`);const[o]=await e.query("SELECT column_name FROM information_schema.`columns` WHERE table_schema = ? AND table_name = ? ORDER BY ORDINAL_POSITION",[t,a]),s=o.map((({column_name:e})=>e)),[r]=await e.query(`SELECT * FROM \`${t}\`.\`${a}\``),c=n.addWorksheet(a);c.columns=s.map((e=>({header:e,key:e,width:k(r,e,2)}))),c.addRows(r.map((e=>D(e))));const i=new u.default.Workbook,l=i.addWorksheet(a);l.columns=s.map((e=>({header:e,key:e}))),l.addRows(r.map((e=>D(e))));const f=`${t}_${a}_selected.csv`,w=d.default.join(_,f),p=await i.csv.writeBuffer(),h=Buffer.from([239,187,191]);m.default.writeFileSync(w,Buffer.concat([h,Buffer.from(p)])),console.log(`✨선택한 테이블이 CSV 파일로 저장되었습니다: ${w}`)}catch(e){console.error(`Error exporting table ${a}:`,e)}const r=`${t}_selected_tables.xlsx`;await n.xlsx.writeFile(d.default.join(_,r)),console.log(`✨ 선택한 테이블이 XLSX 파일로 저장되었습니다: ${d.default.join(_,r)}`)}catch(e){console.error("Error in selectedTablesExport:",e)}}(e,o),await O(o),b(e);break;case"다른 스키마 선택":b(e);break;case"종료":console.log("✨ 프로그램을 종료합니다."),process.exit(0)}}function D(e){return Object.fromEntries(Object.entries(e).map((([e,t])=>[e,t instanceof Date?(0,l.default)(t).format("YYYY-MM-DD HH:mm:ss"):t])))}function g(e){const t=new TextEncoder;return Object.fromEntries(Object.entries(e).map((([e,a])=>[e,Buffer.from(t.encode(a).buffer).toString()])))}async function O(e){switch(await(0,c.select)({message:"저장된 폴더를 여시겠습니까?",choices:["예","아니오"],loop:!1})){case"예":await y(e);break;case"아니오":break;default:O(e)}}async function x(e){""===p?p=await(0,c.input)({message:"데이터베이스 username을 적으세요.",required:!0}):"직접입력하겠습니다."===await(0,c.select)({message:"이전에 입력한 username으로 진행할까요?",choices:["예","직접입력하겠습니다."]})&&(p="",x(e)),""===h?h=await(0,c.password)({message:"데이터베이스 password을 적으세요.",mask:"#"}):"직접입력하겠습니다."===await(0,c.select)({message:"이전에 입력한 password으로 진행할까요?",choices:["예","직접입력하겠습니다."]})&&(p="",x(e)),await new Promise((t=>{console.log("🛠️ sql 파일 저장 중입니다...",_),(0,i.spawn)("cmd",["/C","mysqldump",`-u${p}`,`-p${h}`,"--databases",e,">",`${d.default.join(_,`${e}_output.sql`)}`]).on("close",(()=>{console.log("✨ sql 파일 저장이 완료되었습니다!:",d.default.join(_,`${e}_output.sql`)),t(!0)}))}))}async function y(e=""){const t=(0,m.readdirSync)(d.default.join(w.OUTPUT_DIR,"output"));""===e&&(e=await(0,c.select)({message:"폴더를 선택해주세요.",choices:[...t,new c.Separator,"돌아가기"],loop:!1})),!0===t.includes(e)&&await new Promise((t=>{(0,i.spawn)("cmd",["/C","start",d.default.join(w.OUTPUT_DIR,"output",e)]).on("close",(()=>{t(!0)}))}))}async function v(e,t){await x(t);const[a]=await e.query("select table_name from information_schema.`tables` where information_schema.`tables`.table_schema = ?",[t]),o=a.map((({table_name:e})=>e)),s=new u.default.Workbook;s.creator="kkn1125",s.created=new Date,s.modified=new Date,s.lastPrinted=new Date;for(const a of o){const[o]=await e.query("SELECT\n                column_name\n            FROM\n                information_schema.`columns`\n            WHERE\n                information_schema.`columns`.table_schema = ?\n                    AND information_schema.`columns`.table_name = ?\n                ORDER BY ORDINAL_POSITION",[t,a]);await e.query(`use ${t}`),await e.query("set names utf8mb4");const[n]=await e.query(`SELECT * FROM ${a}`),r=o.map((({column_name:e})=>e)),c=s.addWorksheet(a);c.columns=r.map((e=>({header:e,key:e,width:k(n,e,2)}))),c.addRows(n.map((e=>D(e))));const i=new u.default.Workbook;i.creator="kkn1125",i.created=new Date,i.modified=new Date,i.lastPrinted=new Date;const l=i.addWorksheet(a);l.columns=r.map((e=>({header:e,key:e}))),l.addRows(n.map((e=>g(D(e)))));const f=`${t}_${a}.csv`,w=d.default.join(_,f),p=await i.csv.writeBuffer(),h=Buffer.from([239,187,191]);m.default.writeFileSync(w,Buffer.concat([h,Buffer.from(p)]))}const n=t+"_all_tables.xlsx";await s.xlsx.writeFile(d.default.join(_,n)),console.log(`✨ 테이블이 XLSX 파일로 저장되었습니다: ${d.default.join(_,n)}`)}function k(e,t,a=0){let o=t.length;for(const a of e){const e="object"==typeof(s=a[t])?s instanceof Date?(0,l.default)(s).format("YYYY-MM-DD HH:mm:ss").length:(""+s).length:1.8*((""+s).match(/[ㄱ-ㅎ가-힣]/g)?.length??0)+1.3*((""+s).match(/[A-Z]/g)?.length??0)+1*((""+s).match(/[^A-Zㄱ-ㅎ가-힣]/g)?.length??0);o<e&&(o=e)}var s;return o+a}f.default.createConnection({host:w.DB_HOST,user:w.DB_USER,password:w.DB_PW}).then((async e=>{await b(e)}))},733:e=>{e.exports=require("@inquirer/prompts")},293:e=>{e.exports=require("dayjs")},818:e=>{e.exports=require("dotenv")},608:e=>{e.exports=require("exceljs")},498:e=>{e.exports=require("mysql2/promise")},317:e=>{e.exports=require("child_process")},896:e=>{e.exports=require("fs")},928:e=>{e.exports=require("path")}},t={};!function a(o){var s=t[o];if(void 0!==s)return s.exports;var n=t[o]={exports:{}};return e[o].call(n.exports,n,n.exports,a),n.exports}(156)})();